{{ define "main" }}
<section class="py-16">
  <div class="container mx-auto px-4">
    <h1 class="text-secondary mb-8 text-center font-secondary text-4xl font-bold xl:text-6xl">{{ .Title }}</h1>
    {{ with .Params.description }}
      <p class="mx-auto mb-16 text-center text-gray-dark xl:max-w-[50%]">{{ . }}</p>
    {{ end }}

    <div class="flex flex-col gap-8 xl:flex-row">
      <!-- Sidebar TOC -->
      <aside class="xl:w-64 xl:shrink-0">
        <nav class="bg-primary sticky top-8 rounded-[10px] p-6">
          <h2 class="text-secondary mb-4 font-secondary text-lg font-bold">Contents</h2>
          
          <div class="mb-4">
            <h3 class="text-secondary mb-2 text-sm font-semibold uppercase tracking-wide">Introduction</h3>
            <ul class="flex flex-col gap-1">
              <li>
                <a href="#intro" class="block py-1 text-sm text-gray-dark hover:text-accent duration-200">Welcome</a>
              </li>
            </ul>
          </div>

          {{ $pages := .RegularPagesRecursive.ByWeight }}
          {{ $workAreas := where $pages "Params.section" "Work Areas" }}
          {{ if $workAreas }}
          <div class="mb-4">
            <h3 class="text-secondary mb-2 text-sm font-semibold uppercase tracking-wide">Work Areas</h3>
            <ul class="flex flex-col gap-1">
              {{ range $workAreas }}
              <li>
                <a href="#{{ .Title | urlize }}" class="block py-1 text-sm text-gray-dark hover:text-accent duration-200">
                  {{ .Title }}
                </a>
              </li>
              {{ end }}
            </ul>
          </div>
          {{ end }}

          {{ $team := where $pages "Params.section" "Team" }}
          {{ if $team }}
          <div class="mb-4">
            <h3 class="text-secondary mb-2 text-sm font-semibold uppercase tracking-wide">Team</h3>
            <ul class="flex flex-col gap-1">
              <li>
                <a href="#team-section" class="block py-1 text-sm text-gray-dark hover:text-accent duration-200">Our Team</a>
              </li>
            </ul>
          </div>
          {{ end }}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="min-w-0 flex-1">
        <!-- Introduction Section -->
        <section id="intro" class="mb-12 scroll-mt-8">
          {{ with .Content }}
          <div class="prose prose-lg mb-12 max-w-none prose-headings:font-secondary prose-headings:text-secondary">
            {{ . }}
          </div>
          {{ end }}
        </section>

        <!-- Work Areas Section -->
        {{ range $workAreas }}
        <section id="{{ .Title | urlize }}" class="mb-12 scroll-mt-8">
          <h2 class="text-secondary mb-4 font-secondary text-2xl font-bold">{{ .Title }}</h2>
          <div class="prose prose-lg max-w-none prose-headings:font-secondary prose-headings:text-secondary prose-a:text-accent">
            {{ .Content }}
          </div>
        </section>
        {{ end }}

        <!-- Team Section -->
        {{ if $team }}
        <section id="team-section" class="mb-12 scroll-mt-8">
          <h2 class="text-secondary mb-2 font-secondary text-3xl font-bold">{{ .Params.title | default "Our Team" }}</h2>
          {{ with .Params.subtitle }}
            <p class="text-accent mb-8 font-medium">{{ . }}</p>
          {{ end }}
          <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
            {{ range $team }}
            <div class="bg-primary flex flex-col items-center rounded-[10px] p-6 text-center shadow-sm">
              {{ $img := resources.Get .Params.profile_picture }}
              <div class="mb-4 h-32 w-32 overflow-hidden rounded-full border-4 border-white shadow-md">
                {{ if $img }}
                  <img src="{{ $img.RelPermalink }}" alt="{{ .Title }}" class="h-full w-full object-cover">
                {{ else }}
                  <div class="bg-primary-2 flex h-full w-full items-center justify-center text-gray-dark">
                    <span>{{ .Title | truncate 1 "" }}</span>
                  </div>
                {{ end }}
              </div>
              <h3 class="text-secondary mb-1 font-secondary text-xl font-bold">{{ .Title }}</h3>
              <p class="mb-3 text-sm font-medium text-accent">{{ .Params.role }}</p>
              <div class="prose prose-sm mb-4 text-gray-dark">
                {{ .Content }}
              </div>
              <div class="mt-auto flex gap-4">
                {{ with .Params.social.github }}
                <a href="{{ . }}" class="text-secondary hover:text-accent duration-200" title="GitHub">
                  <span class="sr-only">GitHub</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                  </svg>
                </a>
                {{ end }}
                {{ with .Params.social.gitlab }}
                <a href="{{ . }}" class="text-secondary hover:text-accent duration-200" title="GitLab">
                  <span class="sr-only">GitLab</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="m15.734 8.8-.025-.067V8.73l-1.577-4.854a.541.541 0 0 0-.17-.267.53.53 0 0 0-.306-.1.53.53 0 0 0-.307.1.541.541 0 0 0-.17.267L11.899 8.2h-7.8l-1.28-3.945a.541.541 0 0 0-.17-.267.535.535 0 0 0-.613 0 .541.541 0 0 0-.17.267L.289 9.106a.544.544 0 0 0 .041.442.54.54 0 0 0 .324.235l7.155 2.21 7.155-2.21a.54.54 0 0 0 .324-.235.544.544 0 0 0 .046-.448Z"/>
                  </svg>
                </a>
                {{ end }}
                {{ with .Params.social.linkedin }}
                <a href="{{ . }}" class="text-secondary hover:text-accent duration-200" title="LinkedIn">
                  <span class="sr-only">LinkedIn</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H3.337v7.225h1.606zm-1.56-8.122c.56 0 .966-.37.966-.845 0-.485-.405-.853-.966-.853-.566 0-.972.368-.972.853 0 .475.406.845.972.845zM13.825 13.394V9.302c0-2.192-1.168-3.212-2.73-3.212-1.26 0-1.825.694-2.139 1.189v-.998H7.352c.021.454 0 7.225 0 7.225h1.606V9.334c0-.438.031-.875.16-1.191.35-.875 1.154-1.782 2.506-1.782 1.767 0 2.474 1.348 2.474 3.326v3.717h1.607z"/>
                  </svg>
                </a>
                {{ end }}
              </div>
            </div>
            {{ end }}
          </div>
        </section>
        {{ end }}
      </main>
    </div>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const sections = document.querySelectorAll("section[id]");
  const tocLinks = document.querySelectorAll("aside nav a");

  function updateActiveLink() {
    let currentSection = "";
    sections.forEach(section => {
      const sectionTop = section.offsetTop - 120;
      if (window.scrollY >= sectionTop) {
        currentSection = section.getAttribute("id");
      }
    });
    tocLinks.forEach(link => {
      link.classList.remove("text-accent", "font-semibold");
      link.classList.add("text-gray-dark");
      if (link.getAttribute("href") === "#" + currentSection) {
        link.classList.add("text-accent", "font-semibold");
        link.classList.remove("text-gray-dark");
      }
    });
  }

  window.addEventListener("scroll", updateActiveLink);
  updateActiveLink();
});
</script>
{{ end }}
