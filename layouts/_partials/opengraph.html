{{- /* Resolve description */ -}}
{{- $description := .Site.Params.description -}}
{{- with .Description -}}
  {{- $description = . -}}
{{- end -}}

{{- /* Resolve OG type */ -}}
{{- $ogType := "website" -}}
{{- if and (not .IsHome) (.Date) (not .Date.IsZero) -}}
  {{- $ogType = "article" -}}
{{- end -}}

{{- /* Resolve image via fallback chain */ -}}
{{- $imageURL := "" -}}
{{- $imageWidth := 0 -}}
{{- $imageHeight := 0 -}}

{{- /* 1. Page-level "image" param */ -}}
{{- with .Params.image -}}
  {{- $img := resources.Get . -}}
  {{- with $img -}}
    {{- $fitted := .Fill "1200x630 q85" -}}
    {{- $imageURL = $fitted.Permalink -}}
    {{- $imageWidth = $fitted.Width -}}
    {{- $imageHeight = $fitted.Height -}}
  {{- end -}}
{{- end -}}

{{- /* 2. Page-level "cover" param */ -}}
{{- if not $imageURL -}}
  {{- with .Params.cover -}}
    {{- $img := resources.Get . -}}
    {{- with $img -}}
      {{- $fitted := .Fill "1200x630 q85" -}}
      {{- $imageURL = $fitted.Permalink -}}
      {{- $imageWidth = $fitted.Width -}}
      {{- $imageHeight = $fitted.Height -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* 3. Page-level "gallery" param â€” use first image */ -}}
{{- if not $imageURL -}}
  {{- with .Params.gallery -}}
    {{- $pattern := printf "%s/*" . -}}
    {{- $images := resources.Match $pattern -}}
    {{- with index $images 0 -}}
      {{- $fitted := .Fill "1200x630 q85" -}}
      {{- $imageURL = $fitted.Permalink -}}
      {{- $imageWidth = $fitted.Width -}}
      {{- $imageHeight = $fitted.Height -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* 4. Site default ogImage (static file) */ -}}
{{- if not $imageURL -}}
  {{- with .Site.Params.ogImage -}}
    {{- $imageURL = printf "%s%s" $.Site.BaseURL . -}}
    {{- $imageWidth = 1200 -}}
    {{- $imageHeight = 630 -}}
  {{- end -}}
{{- end -}}

<!-- Open Graph -->
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:description" content="{{ $description }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />
<meta property="og:locale" content="{{ .Site.Language.Lang }}" />
<meta property="og:type" content="{{ $ogType }}" />
{{- if $imageURL }}
<meta property="og:image" content="{{ $imageURL }}" />
  {{- if $imageWidth }}
<meta property="og:image:width" content="{{ $imageWidth }}" />
<meta property="og:image:height" content="{{ $imageHeight }}" />
  {{- end }}
{{- end }}
{{- if eq $ogType "article" }}
  {{- with .Date }}
<meta property="article:published_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}" />
  {{- end }}
  {{- with .Params.author }}
<meta property="article:author" content="{{ . }}" />
  {{- end }}
{{- end }}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ .Title }}" />
<meta name="twitter:description" content="{{ $description }}" />
{{- if $imageURL }}
<meta name="twitter:image" content="{{ $imageURL }}" />
{{- end }}
