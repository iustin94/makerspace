{{ define "main" }}
<section class="py-16">
  <div class="container mx-auto px-4">
    <h1 class="text-secondary mb-8 text-center font-secondary text-4xl font-bold xl:text-6xl">{{ .Title }}</h1>
    {{ with .Params.description }}
      <p class="mx-auto mb-16 text-center text-gray-dark xl:max-w-[50%]">{{ . }}</p>
    {{ end }}

    <div class="flex flex-col gap-8 xl:flex-row">
      <!-- Sidebar TOC -->
      <aside class="xl:w-64 xl:shrink-0">
        <nav class="bg-primary sticky top-8 rounded-[10px] p-6">
          <h2 class="text-secondary mb-4 font-secondary text-lg font-bold">Contents</h2>

          {{ $pages := .Pages.ByWeight }}
          {{ $sections := slice }}
          {{ range $pages }}
            {{ $sections = $sections | append .Params.section }}
          {{ end }}
          {{ $sections = $sections | uniq }}

          {{ range $section := $sections }}
          <div class="mb-4">
            <h3 class="text-secondary mb-2 text-sm font-semibold uppercase tracking-wide">{{ $section }}</h3>
            <ul class="flex flex-col gap-1">
              {{ range $pages }}
              {{ if eq .Params.section $section }}
              <li>
                <a href="#{{ .Params.anchor | default (.Title | urlize) }}" class="block py-1 text-sm text-gray-dark hover:text-accent duration-200">
                  {{ .Title }}
                </a>
              </li>
              {{ end }}
              {{ end }}
            </ul>
          </div>
          {{ end }}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="min-w-0 flex-1">
        {{ with .Content }}
        <div class="prose prose-lg mb-12 max-w-none prose-headings:font-secondary prose-headings:text-secondary">
          {{ . }}
        </div>
        {{ end }}

        {{ range .Pages.ByWeight }}
        <section id="{{ .Params.anchor | default (.Title | urlize) }}" class="mb-12 scroll-mt-8">
          <h2 class="text-secondary mb-4 font-secondary text-2xl font-bold">{{ .Title }}</h2>
          <div class="prose prose-lg max-w-none prose-headings:font-secondary prose-headings:text-secondary prose-a:text-accent">
            {{ .Content }}
          </div>
        </section>
        {{ end }}
      </main>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sections = document.querySelectorAll('section[id]');
  const tocLinks = document.querySelectorAll('aside nav a');

  function updateActiveLink() {
    let currentSection = '';
    sections.forEach(section => {
      const sectionTop = section.offsetTop - 120;
      if (window.scrollY >= sectionTop) {
        currentSection = section.getAttribute('id');
      }
    });
    tocLinks.forEach(link => {
      link.classList.remove('text-accent', 'font-semibold');
      link.classList.add('text-gray-dark');
      if (link.getAttribute('href') === '#' + currentSection) {
        link.classList.add('text-accent', 'font-semibold');
        link.classList.remove('text-gray-dark');
      }
    });
  }

  window.addEventListener('scroll', updateActiveLink);
  updateActiveLink();
});
</script>
{{ end }}
